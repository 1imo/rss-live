---
import '../styles/global.css';

export interface Props {
  title?: string;
  description?: string;
  image?: string;
  canonical?: string;
  type?: 'website' | 'article';
  publishedTime?: string;
  author?: string;
}

const {
  title = 'NewsHub — Latest News from Around the World',
  description = 'Breaking news, politics, business, technology, science, sports and more. Stay informed with trusted journalism from leading sources worldwide.',
  image = '/og-image.jpg',
  canonical,
  type = 'website',
  publishedTime,
  author
} = Astro.props;

const siteUrl = Astro.site?.toString() || import.meta.env.SITE_URL || 'http://localhost:4321/';
const siteName = import.meta.env.SITE_NAME || 'NewsHub';
const fullTitle = title.includes(siteName) ? title : `${title} — ${siteName}`;
const canonicalUrl = canonical || new URL(Astro.url.pathname, siteUrl).toString();
const ogImage = new URL(image, siteUrl).toString();

// Get current date for header
const currentDate = new Date().toLocaleDateString('en-US', {
  weekday: 'long',
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">

    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="manifest" href="/manifest.json">

    <!-- Primary Meta Tags -->
    <title>{fullTitle}</title>
    <meta name="title" content={fullTitle}>
    <meta name="description" content={description}>
    <link rel="canonical" href={canonicalUrl}>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type}>
    <meta property="og:url" content={canonicalUrl}>
    <meta property="og:title" content={fullTitle}>
    <meta property="og:description" content={description}>
    <meta property="og:image" content={ogImage}>
    <meta property="og:site_name" content="NewsHub">
    {publishedTime && (
      <meta property="article:published_time" content={publishedTime}>
    )}
    {author && (
      <meta property="article:author" content={author}>
    )}

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content={canonicalUrl}>
    <meta property="twitter:title" content={fullTitle}>
    <meta property="twitter:description" content={description}>
    <meta property="twitter:image" content={ogImage}>

    <!-- Additional SEO -->
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <meta name="bingbot" content="index, follow">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Theme -->
    <meta name="theme-color" content="#0a0a0a">
    <meta name="color-scheme" content="light dark">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": type === 'article' ? 'NewsArticle' : 'WebSite',
      "name": siteName,
      "description": description,
      "url": siteUrl,
      ...(type === 'website' && {
        "potentialAction": {
          "@type": "SearchAction",
          "target": {
            "@type": "EntryPoint",
            "urlTemplate": `${siteUrl}search?q={search_term_string}`
          },
          "query-input": "required name=search_term_string"
        }
      }),
      ...(type === 'article' && {
        "headline": title,
        "image": ogImage,
        "datePublished": publishedTime,
        "dateModified": publishedTime,
        "author": {
          "@type": "Person",
          "name": author || "Timo Hoyland"
        },
        "publisher": {
          "@type": "Organization",
          "name": siteName,
          "logo": {
            "@type": "ImageObject",
            "url": `${siteUrl}favicon.svg`
          }
        }
      })
    })}></script>

    <!-- Performance Hints -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    
    <!-- Additional head content from pages -->
    <slot name="head" />
  </head>

  <body class="bg-white dark:bg-times-950 text-times-900 dark:text-times-100 font-sans antialiased">
    <!-- Skip to main content -->
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-times-900 text-white px-6 py-3 rounded-md z-50 font-medium transition-all focus:ring-2 focus:ring-times-500"
    >
      Skip to main content
    </a>

    <!-- Header -->
    <header class="sticky top-0 z-40 bg-white/95 dark:bg-times-950/95 backdrop-blur-sm border-b border-times-200 dark:border-times-800">
      <nav class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8" aria-label="Main navigation">
        <!-- Top bar with date and weather -->
        <div class="hidden md:flex justify-between items-center py-3 text-xs text-times-600 dark:text-times-400 border-b border-times-100 dark:border-times-800">
          <div class="flex items-center space-x-4">
            <time datetime={new Date().toISOString()} class="font-medium">
              {currentDate}
            </time>
          </div>
          <div class="flex items-center space-x-4">
            <span class="px-2 py-1 bg-times-100 dark:bg-times-800 text-times-700 dark:text-times-300 rounded-full text-xs font-medium">
              Live Updates
            </span>
          </div>
        </div>

        <!-- Main navigation -->
        <div class="flex justify-between items-center h-16 md:h-20">
          <!-- Logo -->
          <div class="flex items-center">
            <a href="/" class="flex items-center group">
              <div class="text-3xl md:text-4xl font-display font-bold text-times-900 dark:text-white tracking-tight">
                {siteName}
              </div>
              <div class="hidden sm:block ml-2 text-xs text-times-500 dark:text-times-400 font-medium">
                Trusted News
              </div>
            </a>
          </div>

          <!-- Desktop Navigation - Centered -->
          <div class="hidden lg:flex items-center justify-center flex-1">
            <nav class="flex items-center space-x-8">
              <a
                href="/"
                class="px-4 py-2 text-sm font-medium text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white rounded-md hover:bg-times-100 dark:hover:bg-times-800 transition-colors"
              >
                Home
              </a>
              <a
                href="/categories"
                class="px-4 py-2 text-sm font-medium text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white rounded-md hover:bg-times-100 dark:hover:bg-times-800 transition-colors"
              >
                Sections
              </a>
              <a
                href="/category/business"
                class="px-4 py-2 text-sm font-medium text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white rounded-md hover:bg-times-100 dark:hover:bg-times-800 transition-colors"
              >
                Business
              </a>
              <a
                href="/category/technology"
                class="px-4 py-2 text-sm font-medium text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white rounded-md hover:bg-times-100 dark:hover:bg-times-800 transition-colors"
              >
                Technology
              </a>
              <a
                href="/category/science"
                class="px-4 py-2 text-sm font-medium text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white rounded-md hover:bg-times-100 dark:hover:bg-times-800 transition-colors"
              >
                Science
              </a>
              <a
                href="/category/sports"
                class="px-4 py-2 text-sm font-medium text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white rounded-md hover:bg-times-100 dark:hover:bg-times-800 transition-colors"
              >
                Sports
              </a>
            </nav>
          </div>

          <!-- Right side actions -->
          <div class="flex items-center space-x-3">
            <!-- Search button -->
            <a
              href="/search"
              class="p-2 text-times-600 dark:text-times-400 hover:text-times-900 dark:hover:text-white rounded-md hover:bg-times-100 dark:hover:bg-times-800 transition-colors"
              aria-label="Search"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
            </a>

            <!-- Theme toggle -->
            <button
              id="theme-toggle"
              class="p-2 text-times-600 dark:text-times-400 hover:text-times-900 dark:hover:text-white rounded-md hover:bg-times-100 dark:hover:bg-times-800 transition-colors"
              aria-label="Toggle theme"
            >
              <svg class="w-5 h-5 dark:hidden" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
              </svg>
              <svg class="w-5 h-5 hidden dark:block" fill="currentColor" viewBox="0 0 20 20">
                <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
              </svg>
            </button>

            <!-- Mobile menu button -->
            <button
              type="button"
              class="lg:hidden inline-flex items-center justify-center p-2 rounded-md text-times-600 dark:text-times-400 hover:text-times-900 dark:hover:text-white hover:bg-times-100 dark:hover:bg-times-800 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-times-500 transition-colors"
              aria-controls="mobile-menu"
              aria-expanded="false"
              id="mobile-menu-button"
            >
              <span class="sr-only">Open main menu</span>
              <svg class="block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Mobile menu -->
        <div class="lg:hidden hidden" id="mobile-menu">
          <div class="px-2 pt-2 pb-3 space-y-1 bg-white dark:bg-times-950 border-t border-times-200 dark:border-times-800">
            <a href="/" class="block px-3 py-2 rounded-md text-base font-medium text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white hover:bg-times-100 dark:hover:bg-times-800 transition-colors">
              Home
            </a>
            <a href="/categories" class="block px-3 py-2 rounded-md text-base font-medium text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white hover:bg-times-100 dark:hover:bg-times-800 transition-colors">
              Sections
            </a>
            <a href="/category/business" class="block px-3 py-2 rounded-md text-base font-medium text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white hover:bg-times-100 dark:hover:bg-times-800 transition-colors">
              Business
            </a>
            <a href="/category/technology" class="block px-3 py-2 rounded-md text-base font-medium text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white hover:bg-times-100 dark:hover:bg-times-800 transition-colors">
              Technology
            </a>
            <a href="/category/science" class="block px-3 py-2 rounded-md text-base font-medium text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white hover:bg-times-100 dark:hover:bg-times-800 transition-colors">
              Science
            </a>
            <a href="/category/sports" class="block px-3 py-2 rounded-md text-base font-medium text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white hover:bg-times-100 dark:hover:bg-times-800 transition-colors">
              Sports
            </a>
          </div>
        </div>
      </nav>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="flex-1">
      <slot />
    </main>

    <!-- Footer -->
    <footer class="bg-white dark:bg-times-950 text-times-900 dark:text-white border-t border-times-200 dark:border-times-800">
      <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="py-12 md:py-16">
          <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
            <!-- Brand -->
            <div class="md:col-span-2">
              <div class="flex items-center mb-4">
                <div class="text-2xl font-display font-bold">{siteName}</div>
                <div class="ml-2 text-sm text-times-600 dark:text-times-400">Trusted News</div>
              </div>
              <p class="text-times-700 dark:text-times-300 mb-6 max-w-md">
                Stay informed with breaking news, politics, business, technology, science, sports and more from trusted sources worldwide.
              </p>
            </div>

            <!-- Quick Links -->
            <div>
              <h3 class="font-semibold mb-4">Sections</h3>
              <ul class="space-y-2 text-sm">
                <li><a href="/category/general" class="text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white transition-colors">World</a></li>
                <li><a href="/category/government" class="text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white transition-colors">Politics</a></li>
                <li><a href="/category/business" class="text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white transition-colors">Business</a></li>
                <li><a href="/category/technology" class="text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white transition-colors">Technology</a></li>
                <li><a href="/category/science" class="text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white transition-colors">Science</a></li>
                <li><a href="/category/sports" class="text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white transition-colors">Sports</a></li>
              </ul>
            </div>

            <!-- Company -->
            <div>
              <h3 class="font-semibold mb-4">Company</h3>
              <ul class="space-y-2 text-sm">
                <li><a href="/about" class="text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white transition-colors">About</a></li>
                <li><a href="/privacy" class="text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white transition-colors">Privacy</a></li>
                <li><a href="/terms" class="text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white transition-colors">Terms</a></li>
                <li><a href="/contact" class="text-times-700 dark:text-times-300 hover:text-times-900 dark:hover:text-white transition-colors">Contact</a></li>
              </ul>
            </div>
          </div>          <div class="border-t border-times-300 dark:border-times-800 pt-8 mt-12">
            <div class="flex flex-col md:flex-row justify-between items-center">
              <p class="text-times-600 dark:text-times-400 text-sm">
                &copy; {new Date().getFullYear()} {siteName}. All rights reserved.
              </p>
              <div class="flex space-x-6 mt-4 md:mt-0">
                <a href="/rss" class="text-times-600 dark:text-times-400 hover:text-times-900 dark:hover:text-white transition-colors">
                  <span class="sr-only">RSS Feed</span>
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M3.429 2.857A.571.571 0 002.857 3.43v.571c0 .315.256.571.572.571 6.28 0 11.429 5.15 11.429 11.429 0 .315.256.571.571.571h.571a.571.571 0 00.572-.571c0-7.236-5.906-13.143-13.143-13.143zm0 5.714a.571.571 0 00-.572.572v.571c0 .316.256.572.572.572 3.14 0 5.714 2.573 5.714 5.714 0 .315.256.571.571.571h.572a.571.571 0 00.571-.571 7.143 7.143 0 00-7.143-7.143zm1.143 5.715a1.143 1.143 0 11-2.286 0 1.143 1.143 0 012.286 0z"></path>
                  </svg>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Scripts -->
    <script is:inline>
      // Prevent flash of unstyled content by setting theme immediately
      (function() {
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const shouldUseDark = savedTheme === 'dark' || (!savedTheme && prefersDark);

        if (shouldUseDark) {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

        // Set initial theme if not already set by inline script
        if (!savedTheme) {
          html.classList.toggle('dark', prefersDark);
        }

        themeToggle?.addEventListener('click', () => {
          const isDark = html.classList.toggle('dark');
          localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });

        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
          if (!localStorage.getItem('theme')) {
            html.classList.toggle('dark', e.matches);
          }
        });

        // Mobile menu toggle
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        mobileMenuButton?.addEventListener('click', () => {
          const isOpen = mobileMenu?.classList.contains('hidden');
          mobileMenu?.classList.toggle('hidden', !isOpen);
          mobileMenuButton.setAttribute('aria-expanded', String(isOpen));
        });

        // Close mobile menu when clicking on links
        mobileMenu?.querySelectorAll('a')?.forEach(link => {
          link.addEventListener('click', () => {
            mobileMenu.classList.add('hidden');
            mobileMenuButton?.setAttribute('aria-expanded', 'false');
          });
        });

        // Update last updated time
        const lastUpdatedElement = document.getElementById('last-updated');
        if (lastUpdatedElement) {
          setInterval(() => {
            lastUpdatedElement.textContent = new Date().toLocaleTimeString();
          }, 60000);
        }
      });

      // Service worker registration
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/sw.js')
            .then(function(registration) {
              console.log('SW registered: ', registration);
            })
            .catch(function(error) {
              console.log('SW registration failed: ', error);
            });
        });
      }

      // Performance monitoring
      window.addEventListener('load', () => {
        if ('performance' in window) {
          const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
          console.log('Page load time:', loadTime, 'ms');
        }
      });
    </script>
  </body>
</html>
