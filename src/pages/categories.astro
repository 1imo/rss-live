---
import Layout from '../layouts/Layout.astro';
import { newsCategories } from '../config/newsCategories';
import { newsService } from '../services/NewsService';

// Get trending articles by category
const trendingByCategory = await newsService.getTrendingByCategory();
---

<!-- Hero Section -->
<Layout title="News Categories - NewsHub" description="Browse all news categories and sections available on NewsHub">
  <section class="bg-times-50 dark:bg-times-950 border-b border-times-200 dark:border-times-800">
    <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
      <div class="text-center">
        <h1 class="text-4xl lg:text-5xl font-display font-bold text-times-900 dark:text-white mb-4">
          News Sections
        </h1>
        <p class="text-xl text-times-600 dark:text-times-400 max-w-3xl mx-auto">
          Stay informed across all areas of interest. From breaking news to in-depth analysis, explore our comprehensive coverage.
        </p>
      </div>
    </div>
  </section>

  <!-- Categories Grid -->
  <section class="bg-white dark:bg-times-950">
    <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-12 lg:py-16">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        {newsCategories.map((category) => {
          const categoryArticles = trendingByCategory[category.id] || [];
          const articleCount = categoryArticles.length;

          return (
            <div class="group relative rounded-lg shadow-sm hover:shadow-lg dark:shadow-times-950/50 border border-times-200 dark:border-times-700 hover:border-times-300 dark:hover:border-times-600 transition-all duration-300 hover:transform hover:-translate-y-1 flex flex-col h-full bg-white dark:bg-times-950">
              <div class="p-6 flex flex-col flex-1">
                <!-- Category Header -->
                <div class="flex items-center mb-4">
                  <div class={`w-12 h-12 rounded-lg ${category.color} flex items-center justify-center text-white mr-4 flex-shrink-0 p-2`}>
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M2 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 002 2H4a2 2 0 01-2-2V5zm3 1h6v4H5V6zm6 6H5v2h6v-2z" clip-rule="evenodd"></path>
                    </svg>
                  </div>
                  <div class="min-w-0">
                    <h3 class="text-lg font-display font-bold text-times-900 dark:text-white truncate">
                      {category.name}
                    </h3>
                    <p class="text-sm text-times-500 dark:text-times-400">
                      {articleCount} {articleCount === 1 ? 'article' : 'articles'}
                    </p>
                  </div>
                </div>

                <!-- Category Description -->
                <p class="text-sm text-times-600 dark:text-times-300 mb-4 line-clamp-2">
                  {category.description}
                </p>

                <!-- Recent Articles Preview -->
                <div class="flex-1 mb-4">
                  {categoryArticles.length > 0 ? (
                    <div class="space-y-3">
                      <h4 class="text-xs font-semibold text-times-700 dark:text-times-300 uppercase tracking-wide">
                        Recent Stories
                      </h4>
                      <div class="space-y-3">
                        {categoryArticles.slice(0, 2).map((article) => (
                          <div class="group/article border-l-2 border-times-200 dark:border-times-700 pl-3">
                            <h5 class="text-sm font-medium text-times-900 dark:text-white line-clamp-2 group-hover/article:text-times-700 dark:group-hover/article:text-times-300 transition-colors leading-tight">
                              <a href={`/news/${article.slug}`}>
                                {article.title}
                              </a>
                            </h5>
                            <p class="text-xs text-times-500 dark:text-times-400 mt-1">
                              {article.source} Â· {new Date(article.pubDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                            </p>
                          </div>
                        ))}
                      </div>
                    </div>
                  ) : (
                    <div class="flex items-center justify-center py-8 text-times-400 dark:text-times-500">
                      <p class="text-sm">No recent articles</p>
                    </div>
                  )}
                </div>

                <!-- View All Button -->
                <a
                  href={`/category/${category.id}`}
                  class="inline-flex items-center justify-center px-6 py-3 text-sm font-medium rounded-md text-white bg-times-900 dark:bg-white dark:text-times-900 hover:bg-times-800 dark:hover:bg-times-100 transition-colors mt-auto"
                >
                  View All {category.name}
                  <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                </a>
              </div>

              <!-- Decorative Border -->
              <div class={`absolute inset-x-0 bottom-0 h-1 ${category.color} rounded-b-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300`}></div>
            </div>
          );
        })}
      </div>
    </div>
  </section>

  <!-- Quick Access Section -->
  <section class="bg-times-50 dark:bg-times-950">
    <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-display font-bold text-times-900 dark:text-white mb-4">
          Quick Access
        </h2>
        <p class="text-times-600 dark:text-times-400">
          Jump directly to the news that matters most to you
        </p>
      </div>

      <div class="flex flex-wrap justify-center gap-4">
        {newsCategories.map((category) => (
          <a
            href={`/category/${category.id}`}
            class={`inline-flex items-center px-6 py-3 rounded-full text-sm font-medium text-white ${category.color} hover:opacity-90 transition-opacity`}
          >
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M2 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 002 2H4a2 2 0 01-2-2V5zm3 1h6v4H5V6zm6 6H5v2h6v-2z" clip-rule="evenodd"></path>
            </svg>
            {category.name}
          </a>
        ))}
      </div>
    </div>
  </section>
</Layout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
